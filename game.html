<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>贪吃蛇</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      background: #121218;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    .top-bar {
      width: 400px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    #score {
      font-size: 22px;
      color: #00ffaa;
    }
    .top-btn {
      display: flex;
      gap: 8px;
    }
    .top-btn button {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      background: #29293d;
      color: #fff;
      font-size: 14px;
    }
    canvas {
      border: 3px solid #00ffaa;
      background: #000;
      border-radius: 10px;
    }
    .controls {
      margin-top: 15px;
      display: grid;
      grid-template-columns: repeat(3, 70px);
      gap: 10px;
    }
    .controls button {
      width: 70px;
      height: 70px;
      font-size: 26px;
      border: none;
      border-radius: 12px;
      background: #222;
      color: #00ffaa;
    }
    #up { grid-area: 1/2; }
    #left { grid-area: 2/1; }
    #right { grid-area: 2/3; }
    #down { grid-area: 3/2; }

    #gameOverPanel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
    }
    .panel-box {
      background: #1a1a2e;
      padding: 40px;
      border-radius: 15px;
      border: 1px solid #00ffaa;
      text-align: center;
    }
    .panel-box h2 {
      color: #00ffaa;
      margin-bottom: 10px;
    }
    .panel-box p {
      font-size: 18px;
      margin: 10px 0 20px;
    }
    .panel-btn {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      background: #00ffaa;
      color: #000;
      font-size: 16px;
    }
  </style>
</head>
<body>

<div class="top-bar">
  <div class="top-btn">
    <button id="pauseBtn">开始/暂停</button>
    <button onclick="restartGame()">重新开始</button>
    <button onclick="goHome()">返回主页</button>
  </div>
  <div id="score">得分：0</div>
</div>

<canvas id="game" width="400" height="400"></canvas>

<div class="controls">
  <button id="up">↑</button>
  <button id="left">←</button>
  <button id="right">→</button>
  <button id="down">↓</button>
</div>

<div id="gameOverPanel">
  <div class="panel-box">
    <h2>游戏结束</h2>
    <p>最终得分：<span id="finalScore">0</span></p>
    <button class="panel-btn" onclick="restartGame()">重新开始</button>
    <button class="panel-btn" onclick="goHome()">返回主页</button>
  </div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreText = document.getElementById('score');
const pauseBtn = document.getElementById('pauseBtn');
const gameOverPanel = document.getElementById('gameOverPanel');
const finalScore = document.getElementById('finalScore');

const gridSize = 20;
const tileCount = 20;

let snake, food, dx, dy, score, gameOver, isPaused;

function initGame() {
  snake = [{x:10, y:10}];
  food = createFood();
  dx = 0; dy = 0;
  score = 0;
  gameOver = false;
  isPaused = true;
  updateScore();
  gameOverPanel.style.display = "none";
  draw();
}

function createFood() {
  let f;
  do {
    f = {
      x: Math.floor(Math.random() * tileCount),
      y: Math.floor(Math.random() * tileCount)
    };
  } while (snake.some(s => s.x === f.x && s.y === f.y));
  return f;
}

function updateScore() {
  scoreText.innerText = "得分：" + score;
}

function moveSnake() {
  if (gameOver || isPaused) return;
  const head = {x: snake[0].x + dx, y: snake[0].y + dy};

  if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
    endGame();
    return;
  }
  for (let i = 1; i < snake.length; i++) {
    if (snake[i].x === head.x && snake[i].y === head.y) {
      endGame();
      return;
    }
  }

  snake.unshift(head);
  if (head.x === food.x && head.y === food.y) {
    score += 10;
    food = createFood();
    updateScore();
  } else {
    snake.pop();
  }
}

function draw() {
  ctx.fillStyle = "#000";
  ctx.fillRect(0, 0, 400, 400);
  snake.forEach((s, i) => {
    ctx.fillStyle = i === 0 ? "#0f0" : "#0a0";
    ctx.fillRect(s.x * gridSize, s.y * gridSize, gridSize - 2, gridSize - 2);
  });
  ctx.fillStyle = "#f33";
  ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
}

function gameLoop() {
  moveSnake();
  draw();
  setTimeout(gameLoop, 130);
}

function setDir(nx, ny) {
  if (dx === -nx && nx !== 0) return;
  if (dy === -ny && ny !== 0) return;
  dx = nx; dy = ny;
}

document.getElementById("up").onclick = () => setDir(0, -1);
document.getElementById("down").onclick = () => setDir(0, 1);
document.getElementById("left").onclick = () => setDir(-1, 0);
document.getElementById("right").onclick = () => setDir(1, 0);

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") setDir(0, -1);
  if (e.key === "ArrowDown") setDir(0, 1);
  if (e.key === "ArrowLeft") setDir(-1, 0);
  if (e.key === "ArrowRight") setDir(1, 0);
});

function togglePause() {
  if (gameOver) return;
  isPaused = !isPaused;
  pauseBtn.innerText = isPaused ? "开始" : "暂停";
}

function endGame() {
  gameOver = true;
  finalScore.innerText = score;
  gameOverPanel.style.display = "flex";
}

function restartGame() {
  initGame();
}

function goHome() {
  window.location.href = "index.html";
}

pauseBtn.onclick = togglePause;
initGame();
gameLoop();
</script>
</body>
</html>

